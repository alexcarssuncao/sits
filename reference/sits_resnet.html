<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Train ResNet classification models — sits_resnet • sits</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/IBM_Plex_Serif-0.4.10/font.css" rel="stylesheet"><link href="../deps/IBM_Plex_Mono-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Train ResNet classification models — sits_resnet"><meta name="description" content="Use a ResNet architecture for classifying image time series.
The ResNet (or deep residual network) was proposed by a team
in Microsoft Research for 2D image classification.
ResNet tries to address the degradation of accuracy
in a deep network. The idea is to replace a deep network
with a combination of shallow ones.
In the paper by Fawaz et al. (2019), ResNet was considered the best method
for time series classification, using the UCR dataset.
Please refer to the paper for more details.
The R-torch version is based on the code made available by Zhiguang Wang,
author of the original paper. The code was developed in python using keras.
https://github.com/cauchyturing
(repo: UCR_Time_Series_Classification_Deep_Learning_Baseline)
The R-torch version also considered the code by Ignacio Oguiza,
whose implementation is available at
https://github.com/timeseriesAI/tsai/blob/main/tsai/models/ResNet.py.
There are differences between Wang's Keras code and Oguiza torch code.
In this case, we have used Wang's keras code as the main reference."><meta property="og:description" content="Use a ResNet architecture for classifying image time series.
The ResNet (or deep residual network) was proposed by a team
in Microsoft Research for 2D image classification.
ResNet tries to address the degradation of accuracy
in a deep network. The idea is to replace a deep network
with a combination of shallow ones.
In the paper by Fawaz et al. (2019), ResNet was considered the best method
for time series classification, using the UCR dataset.
Please refer to the paper for more details.
The R-torch version is based on the code made available by Zhiguang Wang,
author of the original paper. The code was developed in python using keras.
https://github.com/cauchyturing
(repo: UCR_Time_Series_Classification_Deep_Learning_Baseline)
The R-torch version also considered the code by Ignacio Oguiza,
whose implementation is available at
https://github.com/timeseriesAI/tsai/blob/main/tsai/models/ResNet.py.
There are differences between Wang's Keras code and Oguiza torch code.
In this case, we have used Wang's keras code as the main reference."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">sits</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.5.3-1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/e-sensing/sits/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Train ResNet classification models</h1>
      <small class="dont-index">Source: <a href="https://github.com/e-sensing/sits/blob/HEAD/R/sits_resnet.R" class="external-link"><code>R/sits_resnet.R</code></a></small>
      <div class="d-none name"><code>sits_resnet.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Use a ResNet architecture for classifying image time series.
The ResNet (or deep residual network) was proposed by a team
in Microsoft Research for 2D image classification.
ResNet tries to address the degradation of accuracy
in a deep network. The idea is to replace a deep network
with a combination of shallow ones.
In the paper by Fawaz et al. (2019), ResNet was considered the best method
for time series classification, using the UCR dataset.
Please refer to the paper for more details.</p>
<p>The R-torch version is based on the code made available by Zhiguang Wang,
author of the original paper. The code was developed in python using keras.</p>
<p><a href="https://github.com/cauchyturing" class="external-link">https://github.com/cauchyturing</a>
(repo: UCR_Time_Series_Classification_Deep_Learning_Baseline)</p>
<p>The R-torch version also considered the code by Ignacio Oguiza,
whose implementation is available at
<a href="https://github.com/timeseriesAI/tsai/blob/main/tsai/models/ResNet.py" class="external-link">https://github.com/timeseriesAI/tsai/blob/main/tsai/models/ResNet.py</a>.</p>
<p>There are differences between Wang's Keras code and Oguiza torch code.
In this case, we have used Wang's keras code as the main reference.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">sits_resnet</span><span class="op">(</span></span>
<span>  samples <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  samples_validation <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  blocks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">64</span>, <span class="fl">128</span>, <span class="fl">128</span><span class="op">)</span>,</span>
<span>  kernels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">5</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>  epochs <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  batch_size <span class="op">=</span> <span class="fl">64</span>,</span>
<span>  validation_split <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>  optimizer <span class="op">=</span> <span class="fu">torch</span><span class="fu">::</span><span class="va"><a href="https://torch.mlverse.org/docs/reference/optim_adamw.html" class="external-link">optim_adamw</a></span>,</span>
<span>  opt_hparams <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>lr <span class="op">=</span> <span class="fl">0.001</span>, eps <span class="op">=</span> <span class="fl">1e-08</span>, weight_decay <span class="op">=</span> <span class="fl">1e-06</span><span class="op">)</span>,</span>
<span>  lr_decay_epochs <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  lr_decay_rate <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  patience <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  min_delta <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>  seed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-samples">samples<a class="anchor" aria-label="anchor" href="#arg-samples"></a></dt>
<dd><p>Time series with the training samples.</p></dd>


<dt id="arg-samples-validation">samples_validation<a class="anchor" aria-label="anchor" href="#arg-samples-validation"></a></dt>
<dd><p>Time series with the validation samples. If
the  parameter is provided,
the <code>validation_split</code> is ignored.</p></dd>


<dt id="arg-blocks">blocks<a class="anchor" aria-label="anchor" href="#arg-blocks"></a></dt>
<dd><p>Number of 1D convolutional filters for
each block of three layers.</p></dd>


<dt id="arg-kernels">kernels<a class="anchor" aria-label="anchor" href="#arg-kernels"></a></dt>
<dd><p>Size of the 1D convolutional kernels</p></dd>


<dt id="arg-epochs">epochs<a class="anchor" aria-label="anchor" href="#arg-epochs"></a></dt>
<dd><p>Number of iterations to train the model.
for each layer of each block.</p></dd>


<dt id="arg-batch-size">batch_size<a class="anchor" aria-label="anchor" href="#arg-batch-size"></a></dt>
<dd><p>Number of samples per gradient update.</p></dd>


<dt id="arg-validation-split">validation_split<a class="anchor" aria-label="anchor" href="#arg-validation-split"></a></dt>
<dd><p>Fraction of training data
to be used as validation data.</p></dd>


<dt id="arg-optimizer">optimizer<a class="anchor" aria-label="anchor" href="#arg-optimizer"></a></dt>
<dd><p>Optimizer function to be used.</p></dd>


<dt id="arg-opt-hparams">opt_hparams<a class="anchor" aria-label="anchor" href="#arg-opt-hparams"></a></dt>
<dd><p>Hyperparameters for optimizer:
lr : Learning rate of the optimizer
eps: Term added to the denominator
     to improve numerical stability.
weight_decay:       L2 regularization</p></dd>


<dt id="arg-lr-decay-epochs">lr_decay_epochs<a class="anchor" aria-label="anchor" href="#arg-lr-decay-epochs"></a></dt>
<dd><p>Number of epochs to reduce learning rate.</p></dd>


<dt id="arg-lr-decay-rate">lr_decay_rate<a class="anchor" aria-label="anchor" href="#arg-lr-decay-rate"></a></dt>
<dd><p>Decay factor for reducing learning rate.</p></dd>


<dt id="arg-patience">patience<a class="anchor" aria-label="anchor" href="#arg-patience"></a></dt>
<dd><p>Number of epochs without improvements until
training stops.</p></dd>


<dt id="arg-min-delta">min_delta<a class="anchor" aria-label="anchor" href="#arg-min-delta"></a></dt>
<dd><p>Minimum improvement in loss function
to reset the patience counter.</p></dd>


<dt id="arg-seed">seed<a class="anchor" aria-label="anchor" href="#arg-seed"></a></dt>
<dd><p>Seed for random values.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Verbosity mode (TRUE/FALSE). Default is FALSE.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A fitted model to be used for classification.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Hassan Fawaz, Germain Forestier, Jonathan Weber,
Lhassane Idoumghar,  and Pierre-Alain Muller,
"Deep learning for time series classification: a review",
Data Mining and Knowledge Discovery, 33(4): 917–963, 2019.</p>
<p>Zhiguang Wang, Weizhong Yan, and Tim Oates,
"Time series classification from scratch with deep neural networks:
 A strong baseline",
 2017 International Joint conference on Neural Networks (IJCNN).</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Gilberto Camara, <a href="mailto:gilberto.camara@inpe.br">gilberto.camara@inpe.br</a></p>
<p>Rolf Simoes, <a href="mailto:rolf.simoes@inpe.br">rolf.simoes@inpe.br</a></p>
<p>Felipe Souza, <a href="mailto:lipecaso@gmail.com">lipecaso@gmail.com</a></p>
<p>Felipe Carlos, <a href="mailto:efelipecarlos@gmail.com">efelipecarlos@gmail.com</a></p>
<p>Charlotte Pelletier, <a href="mailto:charlotte.pelletier@univ-ubs.fr">charlotte.pelletier@univ-ubs.fr</a></p>
<p>Daniel Falbel, <a href="mailto:dfalbel@gmail.com">dfalbel@gmail.com</a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="sits_run_examples.html">sits_run_examples</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="co"># create a ResNet model</span></span></span>
<span class="r-in"><span>    <span class="va">torch_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="sits_train.html">sits_train</a></span><span class="op">(</span><span class="va">samples_modis_ndvi</span>, <span class="fu">sits_resnet</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="co"># plot the model</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="plot.html">plot</a></span><span class="op">(</span><span class="va">torch_model</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="co"># create a data cube from local files</span></span></span>
<span class="r-in"><span>    <span class="va">data_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/raster/mod13q1"</span>, package <span class="op">=</span> <span class="st">"sits"</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">cube</span> <span class="op">&lt;-</span> <span class="fu"><a href="sits_cube.html">sits_cube</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>        source <span class="op">=</span> <span class="st">"BDC"</span>,</span></span>
<span class="r-in"><span>        collection <span class="op">=</span> <span class="st">"MOD13Q1-6.1"</span>,</span></span>
<span class="r-in"><span>        data_dir <span class="op">=</span> <span class="va">data_dir</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="co"># classify a data cube</span></span></span>
<span class="r-in"><span>    <span class="va">probs_cube</span> <span class="op">&lt;-</span> <span class="fu"><a href="sits_classify.html">sits_classify</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>        data <span class="op">=</span> <span class="va">cube</span>, ml_model <span class="op">=</span> <span class="va">torch_model</span>, output_dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="co"># plot the probability cube</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="plot.html">plot</a></span><span class="op">(</span><span class="va">probs_cube</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="co"># smooth the probability cube using Bayesian statistics</span></span></span>
<span class="r-in"><span>    <span class="va">bayes_cube</span> <span class="op">&lt;-</span> <span class="fu"><a href="sits_smooth.html">sits_smooth</a></span><span class="op">(</span><span class="va">probs_cube</span>, output_dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="co"># plot the smoothed cube</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="plot.html">plot</a></span><span class="op">(</span><span class="va">bayes_cube</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="co"># label the probability cube</span></span></span>
<span class="r-in"><span>    <span class="va">label_cube</span> <span class="op">&lt;-</span> <span class="fu"><a href="sits_label_classification.html">sits_label_classification</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>        <span class="va">bayes_cube</span>, output_dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="co"># plot the labelled cube</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="plot.html">plot</a></span><span class="op">(</span><span class="va">label_cube</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rolf Simoes, Gilberto Camara, Felipe Souza, Felipe Carlos.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

