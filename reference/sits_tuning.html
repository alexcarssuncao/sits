<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Tuning machine learning models hyper-parameters — sits_tuning • sits</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/IBM_Plex_Serif-0.4.10/font.css" rel="stylesheet"><link href="../deps/IBM_Plex_Mono-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Tuning machine learning models hyper-parameters — sits_tuning"><meta name="description" content="This function performs a random search on values of selected hyperparameters,
and produces a data frame with the accuracy and kappa values produced
by a validation procedure. The result allows users to select appropriate
hyperparameters for deep learning models."><meta property="og:description" content="This function performs a random search on values of selected hyperparameters,
and produces a data frame with the accuracy and kappa values produced
by a validation procedure. The result allows users to select appropriate
hyperparameters for deep learning models."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">sits</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.5.3-1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item"><a class="nav-link" href="https://e-sensing.github.io/sitsbook/">Book</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/e-sensing/sits/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Tuning machine learning models hyper-parameters</h1>
      <small class="dont-index">Source: <a href="https://github.com/e-sensing/sits/blob/HEAD/R/sits_tuning.R" class="external-link"><code>R/sits_tuning.R</code></a></small>
      <div class="d-none name"><code>sits_tuning.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function performs a random search on values of selected hyperparameters,
and produces a data frame with the accuracy and kappa values produced
by a validation procedure. The result allows users to select appropriate
hyperparameters for deep learning models.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">sits_tuning</span><span class="op">(</span></span>
<span>  <span class="va">samples</span>,</span>
<span>  samples_validation <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  validation_split <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>  ml_method <span class="op">=</span> <span class="fu"><a href="sits_tempcnn.html">sits_tempcnn</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  params <span class="op">=</span> <span class="fu"><a href="sits_tuning_hparams.html">sits_tuning_hparams</a></span><span class="op">(</span>optimizer <span class="op">=</span> <span class="fu">torch</span><span class="fu">::</span><span class="va"><a href="https://torch.mlverse.org/docs/reference/optim_adamw.html" class="external-link">optim_adamw</a></span>, opt_hparams <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>lr <span class="op">=</span></span>
<span>    <span class="fu">loguniform</span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">1e-04</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  trials <span class="op">=</span> <span class="fl">30L</span>,</span>
<span>  multicores <span class="op">=</span> <span class="fl">2L</span>,</span>
<span>  gpu_memory <span class="op">=</span> <span class="fl">4L</span>,</span>
<span>  batch_size <span class="op">=</span> <span class="fl">2L</span><span class="op">^</span><span class="va">gpu_memory</span>,</span>
<span>  progress <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-samples">samples<a class="anchor" aria-label="anchor" href="#arg-samples"></a></dt>
<dd><p>Time series set to be validated.</p></dd>


<dt id="arg-samples-validation">samples_validation<a class="anchor" aria-label="anchor" href="#arg-samples-validation"></a></dt>
<dd><p>Time series set used for validation.</p></dd>


<dt id="arg-validation-split">validation_split<a class="anchor" aria-label="anchor" href="#arg-validation-split"></a></dt>
<dd><p>Percent of original time series set to be used
for validation (if samples_validation is NULL)</p></dd>


<dt id="arg-ml-method">ml_method<a class="anchor" aria-label="anchor" href="#arg-ml-method"></a></dt>
<dd><p>Machine learning method.</p></dd>


<dt id="arg-params">params<a class="anchor" aria-label="anchor" href="#arg-params"></a></dt>
<dd><p>List with hyper parameters to be passed to
<code>ml_method</code>. User can use <code>uniform</code>, <code>choice</code>,
<code>randint</code>, <code>normal</code>, <code>lognormal</code>, <code>loguniform</code>,
and <code>beta</code> distribution functions to randomize parameters.</p></dd>


<dt id="arg-trials">trials<a class="anchor" aria-label="anchor" href="#arg-trials"></a></dt>
<dd><p>Number of random trials to perform the search.</p></dd>


<dt id="arg-multicores">multicores<a class="anchor" aria-label="anchor" href="#arg-multicores"></a></dt>
<dd><p>Number of cores to process in parallel.</p></dd>


<dt id="arg-gpu-memory">gpu_memory<a class="anchor" aria-label="anchor" href="#arg-gpu-memory"></a></dt>
<dd><p>Memory available in GPU in GB (default = 4)</p></dd>


<dt id="arg-batch-size">batch_size<a class="anchor" aria-label="anchor" href="#arg-batch-size"></a></dt>
<dd><p>Batch size for GPU classification.</p></dd>


<dt id="arg-progress">progress<a class="anchor" aria-label="anchor" href="#arg-progress"></a></dt>
<dd><p>Show progress bar?</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A tibble containing all parameters used to train on each trial
  ordered by accuracy.</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>Machine learning models use stochastic gradient descent (SGD) techniques to
find optimal solutions. To perform SGD, models use optimization
algorithms which have hyperparameters that have to be adjusted
to achieve best performance for each application.
Instead of performing an exhaustive test of all parameter combinations,
<code>sits_tuning</code> selects them randomly.
Validation is done using an independent set
of samples or by a validation split.  The function returns the
best hyper-parameters in a list. Hyper-parameters passed to <code>params</code>
parameter should be passed by calling
<code><a href="sits_tuning_hparams.html">sits_tuning_hparams</a></code>.</p>
<p>When using a GPU for deep learning, <code>gpu_memory</code> indicates the
   memory of the graphics card which is available for processing.
   The parameter <code>batch_size</code> defines the size of the matrix
   (measured in number of rows) which is sent to the GPU for classification.
   Users can test different values of <code>batch_size</code> to
   find out which one best fits their GPU architecture.</p>
<p>It is not possible to have an exact idea of the size of Deep Learning
   models in GPU memory, as the complexity of the model and factors
   such as CUDA Context increase the size of the model in memory.
   Therefore, we recommend that you leave at least 1GB free on the
   video card to store the Deep Learning model that will be used.</p>
<p>For users of Apple M3 chips or similar with a Neural Engine, be
   aware that these chips share memory between the GPU and the CPU.
   Tests indicate that the <code>memsize</code>
   should be set to half to the total memory and the <code>batch_size</code>
   parameter should be a small number (we suggest the value of 64).
   Be aware that increasing these parameters may lead to memory
   conflicts.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>James Bergstra, Yoshua Bengio,
 "Random Search for Hyper-Parameter Optimization".
 Journal of Machine Learning Research. 13: 281–305, 2012.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Rolf Simoes, <a href="mailto:rolfsimoes@gmail.com">rolfsimoes@gmail.com</a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="sits_run_examples.html">sits_run_examples</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="co"># find best learning rate parameters for TempCNN</span></span></span>
<span class="r-in"><span>    <span class="va">tuned</span> <span class="op">&lt;-</span> <span class="fu">sits_tuning</span><span class="op">(</span></span></span>
<span class="r-in"><span>        <span class="va">samples_modis_ndvi</span>,</span></span>
<span class="r-in"><span>        ml_method <span class="op">=</span> <span class="fu"><a href="sits_tempcnn.html">sits_tempcnn</a></span><span class="op">(</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>        params <span class="op">=</span> <span class="fu"><a href="sits_tuning_hparams.html">sits_tuning_hparams</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>            optimizer <span class="op">=</span> <span class="fu">choice</span><span class="op">(</span></span></span>
<span class="r-in"><span>                <span class="fu">torch</span><span class="fu">::</span><span class="va"><a href="https://torch.mlverse.org/docs/reference/optim_adamw.html" class="external-link">optim_adamw</a></span></span></span>
<span class="r-in"><span>            <span class="op">)</span>,</span></span>
<span class="r-in"><span>            opt_hparams <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>                lr <span class="op">=</span> <span class="fu">loguniform</span><span class="op">(</span><span class="fl">10</span><span class="op">^</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">10</span><span class="op">^</span><span class="op">-</span><span class="fl">4</span><span class="op">)</span></span></span>
<span class="r-in"><span>            <span class="op">)</span></span></span>
<span class="r-in"><span>        <span class="op">)</span>,</span></span>
<span class="r-in"><span>        trials <span class="op">=</span> <span class="fl">4</span>,</span></span>
<span class="r-in"><span>        multicores <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>        progress <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="co"># obtain best accuracy, kappa and best_lr</span></span></span>
<span class="r-in"><span>    <span class="va">accuracy</span> <span class="op">&lt;-</span> <span class="va">tuned</span><span class="op">$</span><span class="va">accuracy</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span>    <span class="va">kappa</span> <span class="op">&lt;-</span> <span class="va">tuned</span><span class="op">$</span><span class="va">kappa</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span>    <span class="va">best_lr</span> <span class="op">&lt;-</span> <span class="va">tuned</span><span class="op">$</span><span class="va">opt_hparams</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">lr</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rolf Simoes, Gilberto Camara, Felipe Souza, Felipe Carlos.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

