<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Classify a segmented data cube — sits_classify.segs_cube • sits</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/IBM_Plex_Serif-0.4.10/font.css" rel="stylesheet"><link href="../deps/IBM_Plex_Mono-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Classify a segmented data cube — sits_classify.segs_cube"><meta name="description" content='This function is called when the input is a vector data cube.
Vector data cubes are produced when closed regions are obtained
from raster data cubes using
sits_segment. Classification of a vector
data cube produces a vector data structure with additional
columns expressing the class probabilities for each segment.
Probability cubes for vector data cubes
are objects of class "probs_vector_cube".'><meta property="og:description" content='This function is called when the input is a vector data cube.
Vector data cubes are produced when closed regions are obtained
from raster data cubes using
sits_segment. Classification of a vector
data cube produces a vector data structure with additional
columns expressing the class probabilities for each segment.
Probability cubes for vector data cubes
are objects of class "probs_vector_cube".'></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">sits</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.5.3-1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item"><a class="nav-link" href="https://e-sensing.github.io/sitsbook/">Book</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/e-sensing/sits/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Classify a segmented data cube</h1>
      <small class="dont-index">Source: <a href="https://github.com/e-sensing/sits/blob/master/R/sits_classify.R" class="external-link"><code>R/sits_classify.R</code></a></small>
      <div class="d-none name"><code>sits_classify.segs_cube.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function is called when the input is a vector data cube.
Vector data cubes are produced when closed regions are obtained
from raster data cubes using
<code><a href="sits_segment.html">sits_segment</a></code>. Classification of a vector
data cube produces a vector data structure with additional
columns expressing the class probabilities for each segment.
Probability cubes for vector data cubes
are objects of class "probs_vector_cube".</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># S3 method for class 'vector_cube'</span></span>
<span><span class="fu"><a href="sits_classify.html">sits_classify</a></span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">ml_model</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  roi <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  filter_fn <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  impute_fn <span class="op">=</span> <span class="fu"><a href="impute_linear.html">impute_linear</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  start_date <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  end_date <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  memsize <span class="op">=</span> <span class="fl">8L</span>,</span>
<span>  multicores <span class="op">=</span> <span class="fl">2L</span>,</span>
<span>  gpu_memory <span class="op">=</span> <span class="fl">4L</span>,</span>
<span>  batch_size <span class="op">=</span> <span class="fl">2L</span><span class="op">^</span><span class="va">gpu_memory</span>,</span>
<span>  <span class="va">output_dir</span>,</span>
<span>  version <span class="op">=</span> <span class="st">"v1"</span>,</span>
<span>  n_sam_pol <span class="op">=</span> <span class="fl">15L</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  progress <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>Data cube (tibble of class "raster_cube")</p></dd>


<dt id="arg-ml-model">ml_model<a class="anchor" aria-label="anchor" href="#arg-ml-model"></a></dt>
<dd><p>R model trained by <code><a href="sits_train.html">sits_train</a></code>
(closure of class "sits_model")</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Other parameters for specific functions.</p></dd>


<dt id="arg-roi">roi<a class="anchor" aria-label="anchor" href="#arg-roi"></a></dt>
<dd><p>Region of interest (either an sf object, shapefile,
or a numeric vector in WGS 84 with named XY values
("xmin", "xmax", "ymin", "ymax") or
named lat/long values
("lon_min", "lat_min", "lon_max", "lat_max").</p></dd>


<dt id="arg-filter-fn">filter_fn<a class="anchor" aria-label="anchor" href="#arg-filter-fn"></a></dt>
<dd><p>Smoothing filter to be applied - optional
(closure containing object of class "function").</p></dd>


<dt id="arg-impute-fn">impute_fn<a class="anchor" aria-label="anchor" href="#arg-impute-fn"></a></dt>
<dd><p>Imputation function to remove NA.</p></dd>


<dt id="arg-start-date">start_date<a class="anchor" aria-label="anchor" href="#arg-start-date"></a></dt>
<dd><p>Starting date for the classification
(Date in YYYY-MM-DD format).</p></dd>


<dt id="arg-end-date">end_date<a class="anchor" aria-label="anchor" href="#arg-end-date"></a></dt>
<dd><p>Ending date for the classification
(Date in YYYY-MM-DD format).</p></dd>


<dt id="arg-memsize">memsize<a class="anchor" aria-label="anchor" href="#arg-memsize"></a></dt>
<dd><p>Memory available for classification in GB
(integer, min = 1, max = 16384).</p></dd>


<dt id="arg-multicores">multicores<a class="anchor" aria-label="anchor" href="#arg-multicores"></a></dt>
<dd><p>Number of cores to be used for classification
(integer, min = 1, max = 2048).</p></dd>


<dt id="arg-gpu-memory">gpu_memory<a class="anchor" aria-label="anchor" href="#arg-gpu-memory"></a></dt>
<dd><p>Memory available in GPU in GB (default = 4)</p></dd>


<dt id="arg-batch-size">batch_size<a class="anchor" aria-label="anchor" href="#arg-batch-size"></a></dt>
<dd><p>Batch size for GPU classification.</p></dd>


<dt id="arg-output-dir">output_dir<a class="anchor" aria-label="anchor" href="#arg-output-dir"></a></dt>
<dd><p>Directory for output file.</p></dd>


<dt id="arg-version">version<a class="anchor" aria-label="anchor" href="#arg-version"></a></dt>
<dd><p>Version of the output.</p></dd>


<dt id="arg-n-sam-pol">n_sam_pol<a class="anchor" aria-label="anchor" href="#arg-n-sam-pol"></a></dt>
<dd><p>Number of time series per segment to be classified
(integer, min = 10, max = 50).</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Logical: print information about processing time?</p></dd>


<dt id="arg-progress">progress<a class="anchor" aria-label="anchor" href="#arg-progress"></a></dt>
<dd><p>Logical: Show progress bar?</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Vector data cube with probabilities for each class
                          included in new columns of the tibble.
                          (tibble of class "probs_vector_cube").</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>The <code>roi</code> parameter defines a region of interest. Either:</p><ol><li><p>A path to a shapefile with polygons;</p></li>
<li><p>An <code>sf</code> object with POLYGON or MULTIPOLYGON geometry;</p></li>
<li><p>A named XY vector (<code>xmin</code>, <code>xmax</code>, <code>ymin</code>,
        <code>ymax</code>) in WGS84;</p></li>
<li><p>A name lat/long vector (<code>lon_min</code>, <code>lon_max</code>,
         <code>lat_min</code>, <code>lat_max</code>);</p></li>
</ol><p>Parameter <code>filter_fn</code> parameter specifies a smoothing filter
   to be applied to each time series for reducing noise. Currently, options
   are Savitzky-Golay (see <code><a href="sits_sgolay.html">sits_sgolay</a></code>) and Whittaker
   (see <code><a href="sits_whittaker.html">sits_whittaker</a></code>) filters.</p>
<p>Parameter <code>impute_fn</code> defines a 1D function that will be used
   to interpolate NA values in each time series. Currently sits supports
   the <code><a href="impute_linear.html">impute_linear</a></code> function, but users can define
   imputation functions which are defined externally.</p>
<p>Parameter <code>memsize</code> controls the amount of memory available
   for classification, while <code>multicores</code>  defines the number of cores
   used for processing. We recommend using as much memory as possible.</p>
<p>For classifying vector data cubes created by
   <code><a href="sits_segment.html">sits_segment</a></code>,
   <code>n_sam_pol</code> controls is the number of time series to be
   classified per segment.</p>
<p>When using a GPU for deep learning, <code>gpu_memory</code> indicates the
   memory of the graphics card which is available for processing.
   The parameter <code>batch_size</code> defines the size of the matrix
   (measured in number of rows) which is sent to the GPU for classification.
   Users can test different values of <code>batch_size</code> to
   find out which one best fits their GPU architecture.</p>
<p>It is not possible to have an exact idea of the size of Deep Learning
   models in GPU memory, as the complexity of the model and factors
   such as CUDA Context increase the size of the model in memory.
   Therefore, we recommend that you leave at least 1GB free on the
   video card to store the Deep Learning model that will be used.</p>
<p>For users of Apple M3 chips or similar with a Neural Engine, be
   aware that these chips share memory between the GPU and the CPU.
   Tests indicate that the <code>memsize</code>
   should be set to half to the total memory and the <code>batch_size</code>
   parameter should be a small number (we suggest the value of 64).
   Be aware that increasing these parameters may lead to memory
   conflicts.</p>
<p>Please refer to the sits documentation available in
   <a href="https://e-sensing.github.io/sitsbook/">https://e-sensing.github.io/sitsbook/</a> for detailed examples.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="sits_run_examples.html">sits_run_examples</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="co"># train a random forest model</span></span></span>
<span class="r-in"><span>    <span class="va">rf_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="sits_train.html">sits_train</a></span><span class="op">(</span><span class="va">samples_modis_ndvi</span>, ml_method <span class="op">=</span> <span class="va">sits_rfor</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="co"># Example of classification of a data cube</span></span></span>
<span class="r-in"><span>    <span class="co"># create a data cube from local files</span></span></span>
<span class="r-in"><span>    <span class="va">data_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/raster/mod13q1"</span>, package <span class="op">=</span> <span class="st">"sits"</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">cube</span> <span class="op">&lt;-</span> <span class="fu"><a href="sits_cube.html">sits_cube</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>        source <span class="op">=</span> <span class="st">"BDC"</span>,</span></span>
<span class="r-in"><span>        collection <span class="op">=</span> <span class="st">"MOD13Q1-6.1"</span>,</span></span>
<span class="r-in"><span>        data_dir <span class="op">=</span> <span class="va">data_dir</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="co"># segment the image</span></span></span>
<span class="r-in"><span>    <span class="va">segments</span> <span class="op">&lt;-</span> <span class="fu"><a href="sits_segment.html">sits_segment</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>        cube <span class="op">=</span> <span class="va">cube</span>,</span></span>
<span class="r-in"><span>        seg_fn <span class="op">=</span> <span class="fu"><a href="sits_slic.html">sits_slic</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>            step <span class="op">=</span> <span class="fl">5</span>,</span></span>
<span class="r-in"><span>            compactness <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>            dist_fun <span class="op">=</span> <span class="st">"euclidean"</span>,</span></span>
<span class="r-in"><span>            avg_fun <span class="op">=</span> <span class="st">"median"</span>,</span></span>
<span class="r-in"><span>            iter <span class="op">=</span> <span class="fl">50</span>,</span></span>
<span class="r-in"><span>            minarea <span class="op">=</span> <span class="fl">10</span>,</span></span>
<span class="r-in"><span>            verbose <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span>        <span class="op">)</span>,</span></span>
<span class="r-in"><span>        output_dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="co"># Create a classified vector cube</span></span></span>
<span class="r-in"><span>    <span class="va">probs_segs</span> <span class="op">&lt;-</span> <span class="fu"><a href="sits_classify.html">sits_classify</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>        data <span class="op">=</span> <span class="va">segments</span>,</span></span>
<span class="r-in"><span>        ml_model <span class="op">=</span> <span class="va">rf_model</span>,</span></span>
<span class="r-in"><span>        output_dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>        multicores <span class="op">=</span> <span class="fl">4</span>,</span></span>
<span class="r-in"><span>        n_sam_pol <span class="op">=</span> <span class="fl">15</span>,</span></span>
<span class="r-in"><span>        version <span class="op">=</span> <span class="st">"segs"</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="co"># Create a labelled vector cube</span></span></span>
<span class="r-in"><span>    <span class="va">class_segs</span> <span class="op">&lt;-</span> <span class="fu"><a href="sits_label_classification.html">sits_label_classification</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>        cube <span class="op">=</span> <span class="va">probs_segs</span>,</span></span>
<span class="r-in"><span>        output_dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>        multicores <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>        memsize <span class="op">=</span> <span class="fl">4</span>,</span></span>
<span class="r-in"><span>        version <span class="op">=</span> <span class="st">"segs_classify"</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="co"># plot class_segs</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="plot.html">plot</a></span><span class="op">(</span><span class="va">class_segs</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rolf Simoes, Gilberto Camara, Felipe Souza, Felipe Carlos.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

