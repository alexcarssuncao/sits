<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Segment an image — sits_segment • sits</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/IBM_Plex_Serif-0.4.10/font.css" rel="stylesheet"><link href="../deps/IBM_Plex_Mono-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Segment an image — sits_segment"><meta name="description" content='Apply a spatial-temporal segmentation on a data cube based on a user defined
segmentation function. The function applies the segmentation algorithm
"seg_fn" to each tile. The output is a vector data cube, which is a data cube
with an additional vector file in "geopackage" format.'><meta property="og:description" content='Apply a spatial-temporal segmentation on a data cube based on a user defined
segmentation function. The function applies the segmentation algorithm
"seg_fn" to each tile. The output is a vector data cube, which is a data cube
with an additional vector file in "geopackage" format.'></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">sits</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.5.3-1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item"><a class="nav-link" href="https://e-sensing.github.io/sitsbook/">Book</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/e-sensing/sits/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Segment an image</h1>
      <small class="dont-index">Source: <a href="https://github.com/e-sensing/sits/blob/HEAD/R/sits_segmentation.R" class="external-link"><code>R/sits_segmentation.R</code></a></small>
      <div class="d-none name"><code>sits_segment.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Apply a spatial-temporal segmentation on a data cube based on a user defined
segmentation function. The function applies the segmentation algorithm
"seg_fn" to each tile. The output is a vector data cube, which is a data cube
with an additional vector file in "geopackage" format.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">sits_segment</span><span class="op">(</span></span>
<span>  <span class="va">cube</span>,</span>
<span>  seg_fn <span class="op">=</span> <span class="fu"><a href="sits_slic.html">sits_slic</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  roi <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  impute_fn <span class="op">=</span> <span class="fu"><a href="impute_linear.html">impute_linear</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  start_date <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  end_date <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  memsize <span class="op">=</span> <span class="fl">4L</span>,</span>
<span>  multicores <span class="op">=</span> <span class="fl">2L</span>,</span>
<span>  <span class="va">output_dir</span>,</span>
<span>  version <span class="op">=</span> <span class="st">"v1"</span>,</span>
<span>  progress <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-cube">cube<a class="anchor" aria-label="anchor" href="#arg-cube"></a></dt>
<dd><p>Regular data cube</p></dd>


<dt id="arg-seg-fn">seg_fn<a class="anchor" aria-label="anchor" href="#arg-seg-fn"></a></dt>
<dd><p>Function to apply the segmentation</p></dd>


<dt id="arg-roi">roi<a class="anchor" aria-label="anchor" href="#arg-roi"></a></dt>
<dd><p>Region of interest (see below)</p></dd>


<dt id="arg-impute-fn">impute_fn<a class="anchor" aria-label="anchor" href="#arg-impute-fn"></a></dt>
<dd><p>Imputation function to remove NA values.</p></dd>


<dt id="arg-start-date">start_date<a class="anchor" aria-label="anchor" href="#arg-start-date"></a></dt>
<dd><p>Start date for the segmentation</p></dd>


<dt id="arg-end-date">end_date<a class="anchor" aria-label="anchor" href="#arg-end-date"></a></dt>
<dd><p>End date for the segmentation.</p></dd>


<dt id="arg-memsize">memsize<a class="anchor" aria-label="anchor" href="#arg-memsize"></a></dt>
<dd><p>Memory available for classification (in GB).</p></dd>


<dt id="arg-multicores">multicores<a class="anchor" aria-label="anchor" href="#arg-multicores"></a></dt>
<dd><p>Number of cores to be used for classification.</p></dd>


<dt id="arg-output-dir">output_dir<a class="anchor" aria-label="anchor" href="#arg-output-dir"></a></dt>
<dd><p>Directory for output file.</p></dd>


<dt id="arg-version">version<a class="anchor" aria-label="anchor" href="#arg-version"></a></dt>
<dd><p>Version of the output (for multiple
segmentations).</p></dd>


<dt id="arg-progress">progress<a class="anchor" aria-label="anchor" href="#arg-progress"></a></dt>
<dd><p>Show progress bar?</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A tibble of class 'segs_cube' representing the
segmentation.</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>Segmentation requires the following steps:</p><ol><li><p>Create a regular data cube with <code><a href="sits_cube.html">sits_cube</a></code> and
       <code><a href="sits_regularize.html">sits_regularize</a></code>;</p></li>
<li><p>Run <code>sits_segment</code> to obtain a vector data cube
       with polygons that define the boundary of the segments;</p></li>
<li><p>Classify the time series associated to the segments
       with <code><a href="sits_classify.html">sits_classify</a></code>, to get obtain
       a vector probability cube;</p></li>
<li><p>Use <code><a href="sits_label_classification.html">sits_label_classification</a></code> to label the
     vector probability cube;</p></li>
<li><p>Display the results with <code><a href="plot.html">plot</a></code> or
       <code><a href="sits_view.html">sits_view</a></code>.</p></li>
</ol><p>The "roi" parameter defines a region of interest. It can be
   an sf_object, a shapefile, or a bounding box vector with
   named XY values ("xmin", "xmax", "ymin", "ymax") or
   named lat/long values ("lon_min", "lat_min", "lon_max", "lat_max").</p>
<p>As of version 1.5.3, the only <code>seg_fn</code> function available is
   <code><a href="sits_slic.html">sits_slic</a></code>, which uses the Simple Linear
   Iterative Clustering (SLIC) algorithm that clusters pixels to
   generate compact, nearly uniform superpixels. This algorithm has been
   adapted by Nowosad and Stepinski to work with multispectral and
   multitemporal images. SLIC uses spectral similarity and
   proximity in the spectral and temporal space to
   segment the image into superpixels. Superpixels are clusters of pixels
   with similar spectral and temporal responses that are spatially close.</p>
<p>The result of <code>sits_segment</code> is a data cube tibble with an additional
   vector file in the <code>geopackage</code> format. The location of the vector
   file is included in the data cube tibble in a new column, called
   <code>vector_info</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Achanta, Radhakrishna, Appu Shaji, Kevin Smith, Aurelien Lucchi,
        Pascal Fua, and Sabine Süsstrunk. 2012. “SLIC Superpixels Compared
        to State-of-the-Art Superpixel Methods.” IEEE Transactions on
        Pattern Analysis and Machine Intelligence 34 (11): 2274–82.</p>
<p>Nowosad, Jakub, and Tomasz F. Stepinski. 2022. “Extended SLIC
        Superpixels Algorithm for Applications to Non-Imagery Geospatial
        Rasters.” International Journal of Applied Earth Observation
        and Geoinformation 112 (August): 102935.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Gilberto Camara, <a href="mailto:gilberto.camara@inpe.br">gilberto.camara@inpe.br</a></p>
<p>Rolf Simoes, <a href="mailto:rolfsimoes@gmail.com">rolfsimoes@gmail.com</a></p>
<p>Felipe Carvalho, <a href="mailto:felipe.carvalho@inpe.br">felipe.carvalho@inpe.br</a></p>
<p>Felipe Carlos, <a href="mailto:efelipecarlos@gmail.com">efelipecarlos@gmail.com</a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="sits_run_examples.html">sits_run_examples</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="va">data_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/raster/mod13q1"</span>, package <span class="op">=</span> <span class="st">"sits"</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="co"># create a data cube</span></span></span>
<span class="r-in"><span>    <span class="va">cube</span> <span class="op">&lt;-</span> <span class="fu"><a href="sits_cube.html">sits_cube</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>        source <span class="op">=</span> <span class="st">"BDC"</span>,</span></span>
<span class="r-in"><span>        collection <span class="op">=</span> <span class="st">"MOD13Q1-6.1"</span>,</span></span>
<span class="r-in"><span>        data_dir <span class="op">=</span> <span class="va">data_dir</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="co"># segment the vector cube</span></span></span>
<span class="r-in"><span>    <span class="va">segments</span> <span class="op">&lt;-</span> <span class="fu">sits_segment</span><span class="op">(</span></span></span>
<span class="r-in"><span>        cube <span class="op">=</span> <span class="va">cube</span>,</span></span>
<span class="r-in"><span>        seg_fn <span class="op">=</span> <span class="fu"><a href="sits_slic.html">sits_slic</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>            step <span class="op">=</span> <span class="fl">10</span>,</span></span>
<span class="r-in"><span>            compactness <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>            dist_fun <span class="op">=</span> <span class="st">"euclidean"</span>,</span></span>
<span class="r-in"><span>            avg_fun <span class="op">=</span> <span class="st">"median"</span>,</span></span>
<span class="r-in"><span>            iter <span class="op">=</span> <span class="fl">30</span>,</span></span>
<span class="r-in"><span>            minarea <span class="op">=</span> <span class="fl">10</span></span></span>
<span class="r-in"><span>        <span class="op">)</span>,</span></span>
<span class="r-in"><span>        output_dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="co"># create a classification model</span></span></span>
<span class="r-in"><span>    <span class="va">rfor_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="sits_train.html">sits_train</a></span><span class="op">(</span><span class="va">samples_modis_ndvi</span>, <span class="fu"><a href="sits_rfor.html">sits_rfor</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="co"># classify the segments</span></span></span>
<span class="r-in"><span>    <span class="va">seg_probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="sits_classify.html">sits_classify</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>        data <span class="op">=</span> <span class="va">segments</span>,</span></span>
<span class="r-in"><span>        ml_model <span class="op">=</span> <span class="va">rfor_model</span>,</span></span>
<span class="r-in"><span>        output_dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="co"># label the probability segments</span></span></span>
<span class="r-in"><span>    <span class="va">seg_label</span> <span class="op">&lt;-</span> <span class="fu"><a href="sits_label_classification.html">sits_label_classification</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>        cube <span class="op">=</span> <span class="va">seg_probs</span>,</span></span>
<span class="r-in"><span>        output_dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rolf Simoes, Gilberto Camara, Felipe Souza, Felipe Carlos.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

