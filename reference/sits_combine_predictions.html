<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Estimate ensemble prediction based on list of probs cubes — sits_combine_predictions • sits</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/IBM_Plex_Serif-0.4.10/font.css" rel="stylesheet"><link href="../deps/IBM_Plex_Mono-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Estimate ensemble prediction based on list of probs cubes — sits_combine_predictions"><meta name="description" content="Calculate an ensemble predictor based a list of probability
cubes. The function combines the output of two or more models
to derive a weighted average.
The supported types of ensemble predictors are 'average' and
'uncertainty'. In the latter case, the uncertainty cubes need to
be provided using param uncert_cubes."><meta property="og:description" content="Calculate an ensemble predictor based a list of probability
cubes. The function combines the output of two or more models
to derive a weighted average.
The supported types of ensemble predictors are 'average' and
'uncertainty'. In the latter case, the uncertainty cubes need to
be provided using param uncert_cubes."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">sits</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.5.3-1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item"><a class="nav-link" href="https://e-sensing.github.io/sitsbook/">Book</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/e-sensing/sits/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Estimate ensemble prediction based on list of probs cubes</h1>
      <small class="dont-index">Source: <a href="https://github.com/e-sensing/sits/blob/v1.5.3-1/R/sits_combine_predictions.R" class="external-link"><code>R/sits_combine_predictions.R</code></a></small>
      <div class="d-none name"><code>sits_combine_predictions.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Calculate an ensemble predictor based a list of probability
cubes. The function combines the output of two or more models
to derive a weighted average.
The supported types of ensemble predictors are 'average' and
'uncertainty'. In the latter case, the uncertainty cubes need to
be provided using param <code>uncert_cubes</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">sits_combine_predictions</span><span class="op">(</span><span class="va">cubes</span>, type <span class="op">=</span> <span class="st">"average"</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'average'</span></span>
<span><span class="fu">sits_combine_predictions</span><span class="op">(</span></span>
<span>  <span class="va">cubes</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"average"</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  weights <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  memsize <span class="op">=</span> <span class="fl">8L</span>,</span>
<span>  multicores <span class="op">=</span> <span class="fl">2L</span>,</span>
<span>  <span class="va">output_dir</span>,</span>
<span>  version <span class="op">=</span> <span class="st">"v1"</span>,</span>
<span>  progress <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'uncertainty'</span></span>
<span><span class="fu">sits_combine_predictions</span><span class="op">(</span></span>
<span>  <span class="va">cubes</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"uncertainty"</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  <span class="va">uncert_cubes</span>,</span>
<span>  memsize <span class="op">=</span> <span class="fl">8L</span>,</span>
<span>  multicores <span class="op">=</span> <span class="fl">2L</span>,</span>
<span>  <span class="va">output_dir</span>,</span>
<span>  version <span class="op">=</span> <span class="st">"v1"</span>,</span>
<span>  progress <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Default S3 method</span></span>
<span><span class="fu">sits_combine_predictions</span><span class="op">(</span><span class="va">cubes</span>, <span class="va">type</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-cubes">cubes<a class="anchor" aria-label="anchor" href="#arg-cubes"></a></dt>
<dd><p>List of probability data cubes (class "probs_cube")</p></dd>


<dt id="arg-type">type<a class="anchor" aria-label="anchor" href="#arg-type"></a></dt>
<dd><p>Method to measure uncertainty. One of "average" or
"uncertainty"</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Parameters for specific functions.</p></dd>


<dt id="arg-weights">weights<a class="anchor" aria-label="anchor" href="#arg-weights"></a></dt>
<dd><p>Weights for averaging (numeric vector).</p></dd>


<dt id="arg-memsize">memsize<a class="anchor" aria-label="anchor" href="#arg-memsize"></a></dt>
<dd><p>Memory available for classification in GB
(integer, min = 1, max = 16384).</p></dd>


<dt id="arg-multicores">multicores<a class="anchor" aria-label="anchor" href="#arg-multicores"></a></dt>
<dd><p>Number of cores to be used for classification
(integer, min = 1, max = 2048).</p></dd>


<dt id="arg-output-dir">output_dir<a class="anchor" aria-label="anchor" href="#arg-output-dir"></a></dt>
<dd><p>Valid directory for output file.
(character vector of length 1).</p></dd>


<dt id="arg-version">version<a class="anchor" aria-label="anchor" href="#arg-version"></a></dt>
<dd><p>Version of the output
(character vector of length 1).</p></dd>


<dt id="arg-progress">progress<a class="anchor" aria-label="anchor" href="#arg-progress"></a></dt>
<dd><p>Set progress bar?</p></dd>


<dt id="arg-uncert-cubes">uncert_cubes<a class="anchor" aria-label="anchor" href="#arg-uncert-cubes"></a></dt>
<dd><p>Uncertainty cubes to be used as local weights when
type = "uncertainty" is selected
(list of tibbles with class "uncertainty_cube")</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A combined probability cube (tibble of class "probs_cube").</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>The distribution of class probabilities produced by machine learning
models such as random forest
is quite different from that produced by deep learning models
such as temporal CNN. Combining the result of two different models
is recommended to remove possible bias induced by a single model.</p>
<p>By default, the function takes the average of the class probabilities
of two or more model results. If desired, users can use the uncertainty
estimates for each results to compute the weights for each pixel.
In this case, the uncertainties produced by the models for each pixel
are used to compute the weights for producing the combined result.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Gilberto Camara, <a href="mailto:gilberto.camara@inpe.br">gilberto.camara@inpe.br</a></p>
<p>Rolf Simoes, <a href="mailto:rolfsimoes@gmail.com">rolfsimoes@gmail.com</a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="sits_run_examples.html">sits_run_examples</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="co"># create a data cube from local files</span></span></span>
<span class="r-in"><span>    <span class="va">data_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/raster/mod13q1"</span>, package <span class="op">=</span> <span class="st">"sits"</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">cube</span> <span class="op">&lt;-</span> <span class="fu"><a href="sits_cube.html">sits_cube</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>        source <span class="op">=</span> <span class="st">"BDC"</span>,</span></span>
<span class="r-in"><span>        collection <span class="op">=</span> <span class="st">"MOD13Q1-6.1"</span>,</span></span>
<span class="r-in"><span>        data_dir <span class="op">=</span> <span class="va">data_dir</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="co"># create a random forest model</span></span></span>
<span class="r-in"><span>    <span class="va">rfor_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="sits_train.html">sits_train</a></span><span class="op">(</span><span class="va">samples_modis_ndvi</span>, <span class="fu"><a href="sits_rfor.html">sits_rfor</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="co"># classify a data cube using rfor model</span></span></span>
<span class="r-in"><span>    <span class="va">probs_rfor_cube</span> <span class="op">&lt;-</span> <span class="fu"><a href="sits_classify.html">sits_classify</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>        data <span class="op">=</span> <span class="va">cube</span>, ml_model <span class="op">=</span> <span class="va">rfor_model</span>, output_dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>        version <span class="op">=</span> <span class="st">"rfor"</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="co"># create an SVM model</span></span></span>
<span class="r-in"><span>    <span class="va">svm_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="sits_train.html">sits_train</a></span><span class="op">(</span><span class="va">samples_modis_ndvi</span>, <span class="fu"><a href="sits_svm.html">sits_svm</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="co"># classify a data cube using SVM model</span></span></span>
<span class="r-in"><span>    <span class="va">probs_svm_cube</span> <span class="op">&lt;-</span> <span class="fu"><a href="sits_classify.html">sits_classify</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>        data <span class="op">=</span> <span class="va">cube</span>, ml_model <span class="op">=</span> <span class="va">svm_model</span>, output_dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>        version <span class="op">=</span> <span class="st">"svm"</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="co"># create a list of predictions to be combined</span></span></span>
<span class="r-in"><span>    <span class="va">pred_cubes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">probs_rfor_cube</span>, <span class="va">probs_svm_cube</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="co"># combine predictions</span></span></span>
<span class="r-in"><span>    <span class="va">comb_probs_cube</span> <span class="op">&lt;-</span> <span class="fu">sits_combine_predictions</span><span class="op">(</span></span></span>
<span class="r-in"><span>        <span class="va">pred_cubes</span>,</span></span>
<span class="r-in"><span>        output_dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="co"># plot the resulting combined prediction cube</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="plot.html">plot</a></span><span class="op">(</span><span class="va">comb_probs_cube</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rolf Simoes, Gilberto Camara, Felipe Souza, Felipe Carlos.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

