<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Contributing to the sits R package • sits</title><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/IBM_Plex_Serif-0.4.10/font.css" rel="stylesheet"><link href="deps/IBM_Plex_Mono-0.4.10/font.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Contributing to the sits R package"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">sits</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.5.3-1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/e-sensing/sits/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Contributing to the sits R package</h1>
      <small class="dont-index">Source: <a href="https://github.com/e-sensing/sits/blob/HEAD/contributing.md" class="external-link"><code>contributing.md</code></a></small>
    </div>

<div id="contributing-to-the-sits-r-package" class="section level1">

<p>We welcome all contributors to sits package! Please submit questions, bug reports, and requests in the <a href="https://github.com/e-sensing/sits/issues" class="external-link">issues tracker</a>. If you plan to contribute code, go ahead! Fork the repo and submit a pull request. A few notes:</p>
<ul><li>This package is released with a <a href="CODE_OF_CONDUCT.html">Contributor Code of Conduct</a>. By participating in this project you agree to abide by its terms.</li>
<li>If you have large changes, please open an issue first to discuss.</li>
<li>We will include contributors as authors in the DESCRIPTION file (with their permission) for contributions that go beyond small typos in code or documentation.</li>
<li>This package generally uses the <a href="https://github.com/ropensci/onboarding/blob/master/packaging_guide.md" class="external-link">rOpenSci packaging guidelines</a> for style and structure.</li>
<li>Documentation is generated by <strong>roxygen2</strong>. Please write documentation in code files and let it auto-generate documentation files.<br></li>
<li>For more substantial contributions, consider adding a new section to one of the chapters of the SITS book (<a href="https://e-sensing.github.io/sitsbook/" class="uri">https://e-sensing.github.io/sitsbook/</a>), which has been written in R markdown and whose source is available in the <a href="https://github.com/e-sensing/sitsbook" class="external-link">sitsbook repository</a>.</li>
<li>We aim for testing that has high coverage and is robust. Include tests with any major contribution to code.</li>
<li>We particularly welcome additions in two areas: new STAC-based image repositories and new raster machine learning/deep learning algorithms. Please see more details below.</li>
</ul><div class="section level2">
<h2 id="general-structure-of-sits-code">General structure of sits code.<a class="anchor" aria-label="anchor" href="#general-structure-of-sits-code"></a></h2>
<p>New functions that build on the <code>sits</code> API should follow the general principles below.</p>
<div class="section level3">
<h3 id="api-design">API design<a class="anchor" aria-label="anchor" href="#api-design"></a></h3>
<ul><li><p>The target audience for <code>sits</code> is the community of remote sensing experts with Earth Sciences background who want to use state-of-the-art data analysis methods with minimal investment in programming skills. The design of the <code>sits</code> API considers the typical workflow for land classification using satellite image time series and thus provides a clear and direct set of functions, which are easy to learn and master.</p></li>
<li><p>For this reason, we welcome contributors that provide useful additions to the existing API, such as new ML/DL classification algorithms. In case of a new API function, before making a pull request please raise an issue stating your rationale for a new function.</p></li>
</ul></div>
<div class="section level3">
<h3 id="r-programming-models">R programming models<a class="anchor" aria-label="anchor" href="#r-programming-models"></a></h3>
<ul><li><p>Most functions in <code>sits</code> use the S3 programming model with a strong emphasis on generic methods wich are specialized depending on the input data type. See for example the implementation of the <code><a href="reference/sits_bands.html">sits_bands()</a></code> function.</p></li>
<li><p>Please do not include contributed code using the S4 programming model. Doing so would break the structure and the logic of existing code. Convert your code from S4 to S3.</p></li>
<li><p>Use generic functions as much as possible, as they improve modularity and maintenance. If your code has decision points using <code>if-else</code> clauses, such as <code>if A, do X; else do Y</code> consider using generic functions.</p></li>
<li><p>Functions that use the <code>torch</code> package use the R6 model to be compatible with that package. See for example, the code in <code>sits_tempcnn.R</code> and <code>api_torch.R</code>. To convert <code>pyTorch</code> code to R and include it is straightforward. Please see the <a href="https://e-sensing.github.io/sitsbook/technical-annex.html">Technical Annex</a> of the sits on-line book.</p></li>
</ul></div>
<div class="section level3">
<h3 id="adherence-to-the-tidyverse-sf-and-terra">Adherence to the <code>tidyverse</code>, <code>sf</code> and <code>terra</code>
<a class="anchor" aria-label="anchor" href="#adherence-to-the-tidyverse-sf-and-terra"></a></h3>
<p>The sits <code>code</code> relies on the packages of the <code>tidyverse</code> to work with tables and list. We use <code>dplyr</code> and <code>tidyr</code> for data selection and wrangling, <code>purrr</code> and <code>slider</code> for loops on lists and table, <code>lubridate</code> to handle dates and times.</p>
</div>
<div class="section level3">
<h3 id="adherence-to-the-sits-data-types">Adherence to the <code>sits</code> data types<a class="anchor" aria-label="anchor" href="#adherence-to-the-sits-data-types"></a></h3>
<ul><li><p>The <code>sits</code> package in built on top of three data types: time series tibble, data cubes and models. Most <code>sits</code> functions have one or more of these types as inputs and one of them as return values.</p></li>
<li><p>The time series tibble contains data and metadata. The first six columns contain the metadata: spatial and temporal information, the label assigned to the sample, and the data cube from where the data has been extracted. The time_series column contains the time series data for each spatiotemporal location. All time series tibbles are objects of class <code>sits</code>.</p></li>
<li><p>The <code>cube</code> data type is designed to store metadata about image files. In principle, images which are part of a data cube share the same geographical region, have the same bands, and have been regularized to fit into a pre-defined temporal interval. Data cubes in <code>sits</code> are organized by tiles. A tile is an element of a satellite’s mission reference system, for example MGRS for Sentinel-2 and WRS2 for Landsat. A <code>cube</code> is a tibble where each row contains information about data covering one tile. Each row of the cube tibble contains a column named <code>file_info</code>; this column contains a list that stores a tibble</p></li>
<li><p>The <code>cube</code> data type is specialised in <code>raster_cube</code> (ARD images), <code>vector_cube</code> (ARD cube with segmentation vectors). <code>probs_cube</code> (probabilities produced by classification algorithms on raster data), <code>probs_vector_cube</code>(probabilites generated by vector classification of segments), <code>uncertainty_cube</code> (cubes with uncertainty information), and <code>class_cube</code> (labelled maps). See the code in <code>sits_plot.R</code> as an example of specialisation of <code>plot</code> to handle different classes of raster data.</p></li>
<li><p>All ML/DL models in <code>sits</code> which are the result of <code>sits_train</code> belong to the <code>ml_model</code> class. In addition, models are assigned a second class, which is unique to ML models (e.g, <code>rfor_model</code>, <code>svm_model</code>) and generic for all DL <code>torch</code> based models (<code>torch_model</code>). The class information is used for plotting models and for establishing if a model can run on GPUs.</p></li>
</ul></div>
<div class="section level3">
<h3 id="literal-values-error-messages-and-colors">Literal values, error messages and colors<a class="anchor" aria-label="anchor" href="#literal-values-error-messages-and-colors"></a></h3>
<ul><li><p>The internal <code>sits</code> code has no literal values, which are all stored in the YAML configuration files <code>./inst/extdata/config.yml</code> and <code>./inst/extdata/config_internals.yml</code>. The first file contains configuration parameters that are relevant to users, related to visualisation and plotting; the second contains parameters that are relevant only for developers. These values are accessible using the <code>.conf</code> function. For example, the value of the default size for leaflet objects (64 MB) is accessed using the command <code>.conf["view", "leaflet_megabytes"]</code>.</p></li>
<li><p>Error messages are also stored outside of the code in the YAML configuration file <code>./inst/extdata/config_messages.yml</code>. These values are accessible using the <code>.conf</code> function. For example, the error associated to an invalid NA value for an input parameter is accessible using th function <code>.conf("messages", ".check_na_parameter")</code>.</p></li>
<li><p>Color handling in <code>sits</code> is described in the Technical Annex section <a href="https://e-sensing.github.io/sitsbook/technical-annex.html#how-colors-work-in-sits">“How colors work in sits”</a>. The legends and colors available by default are described in the YAML file <code>./inst/extdata/config_colors.yml</code>.</p></li>
</ul></div>
<div class="section level3">
<h3 id="supporting-new-stac-based-image-catalogues">Supporting new STAC-based image catalogues<a class="anchor" aria-label="anchor" href="#supporting-new-stac-based-image-catalogues"></a></h3>
<ul><li><p>If you want to include a STAC-based catalogue not yet supported by <code>sits</code>, we encourage you to look at existing implementations of catalogues such as Microsoft Planetary Computer (MPC), Digital Earth Africa (DEA) and AWS.</p></li>
<li><p>STAC-based catalogues in <code>sits</code> are associated to YAML description files, which are available in the directory <code>.inst/exdata/sources</code>. For example, the YAML file <code>config_source_mpc.yml</code> describes the contents of the MPC collections supported by <code>sits</code>. Please first provide an YAML file which lists the detailed contents of the new catalogue you wish to include. Follow the examples provided.</p></li>
<li><p>After writing the YAML file, you need to consider how to access and query the new catalogue. The entry point for access to all catalogues is the <code><a href="reference/sits_cube.stac_cube.html">sits_cube.stac_cube()</a></code> function, which in turn calls a sequence of functions which are described in the generic interface <code>api_source.R</code>. Most calls of this API are handled by the functions of <code>api_source_stac.R</code> which provides an interface to the <code>rstac</code> package and handles STAC queries.</p></li>
<li><p>Each STAC catalogue is different. The STAC specification allows providers to implement their data descriptions with specific information. For this reason, the generic API described in <code>api_source.R</code> needs to be specialized for each provider. Whenever a provider needs specific implementations of parts of the STAC protocol, we include them in separate files. For example, <code>api_source_mpc.R</code> implements specific quirks of the MPC platform. Similarly, specific support for CDSE (Copernicus Data Space Environment) is available in <code>api_source_cdse.R</code>.</p></li>
</ul></div>
<div class="section level3">
<h3 id="supporting-new-machine-learning-and-deep-learning-algorithms">Supporting new Machine Learning and Deep Learning algorithms<a class="anchor" aria-label="anchor" href="#supporting-new-machine-learning-and-deep-learning-algorithms"></a></h3>
<ul><li><p>In general terms, ML/DL algorithms in <code>sits</code> are encapsulated as closures which are the output of the <code><a href="reference/sits_train.html">sits_train()</a></code> function. In line with the established practices in <strong>R</strong>, each closure contains a function that classifies input values, as well as information on the samples used to train the model.</p></li>
<li><p>Please read the <a href="https://e-sensing.github.io/sitsbook/technical-annex.html#including-new-methods-for-machine-learning">Technical Annex</a> to the <code>sits</code> book. It describes how include a new ML method, in this case the <code>lightGBM</code> algorithm. Follow those guidelines to include a new ML algorithm.</p></li>
<li><p>If you aim to include a <code>torch</code> based deep learning method, in addition to understanding the concepts presented in the Technical Annex please study carefully the implementation of <code><a href="reference/sits_tempcnn.html">sits_tempcnn()</a></code> and <code><a href="reference/sits_lighttae.html">sits_lighttae()</a></code>.</p></li>
<li><p>Bear in mind that your only task is to provide a new function that is compatible with the requirements of ML/DL methods in <code>sits</code>. Once the function has been correctly implemented, you will be able to use in connection with the rest of <code>sits</code>.</p></li>
</ul></div>
</div>
<div class="section level2">
<h2 id="roadmap">Roadmap<a class="anchor" aria-label="anchor" href="#roadmap"></a></h2>
<ul><li>The roadmap for <code>sits</code> is included as part of the <a href="https://github.com/e-sensing/sits/issues" class="external-link">issues tracker</a>. Issues created by the developers are assigned to milestones. Each milestone corresponds to an expected new version of <code>sits</code> to be released in CRAN.</li>
</ul></div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rolf Simoes, Gilberto Camara, Felipe Souza, Felipe Carlos.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

